---

- name: Ensure app directory
  file:
    path: app
    state: directory
    mode: 0755

- name: Download app_jarfiles
  get_url:
    url: "{{ item.url }}"
    dest: app/{{ item.name }}.jar
  with_items: "{{ app_jarfiles }}"

- name: Pull java8 docker image
  docker_image:
    name: openjdk:8-jre

- name: Deploy dockerfile
  template:
    src: Dockerfile.j2
    dest: app/Dockerfile
    mode: 0644
  register: df

- name: Build container for app
  docker_image:
    name: craftbukkit
    path: app
    force: "{{ df|changed }}"
    buildargs:
      listen_port: 25565

- name: Launch container
  docker_container:
    name: craftbukkit
    image: craftbukkit
    state: started
    volumes: app:/app:rw
    published_ports: 25565:25565
